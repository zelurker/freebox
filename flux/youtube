#!/usr/bin/perl

use common::sense;
use search;

# une refonte ultra simplifiée du plugin youtube :
# puisqu'on s'en sort pas avec le décodage html, on fait une approche inverse : on demande un titre, qu'on cherche sur un moteur de recherche
# si on trouve un line youtube, on le passe directement à mpv, fin de l'histoire !
# TODO: ajouter une option pour enregistrer la vidéo sur disque en option, pour l'instant il lit directrement sans garder aucune trace

my $str = shift @ARGV;
if (!$str) {
	say "Recherche";
	exit(0);
}
say STDERR "obtenu $str";
$str =~ s/^result://;
my $mech = search::search($str);
foreach ($mech->links) {
	my $u = $_->url;
	if ($u =~ /youtube/) {
		say STDERR "on envoie le lien $u";
		say "$u";
		exit(0);
	}
}
say "Désolé, pas trouvé de lien youtube";
exit(0);

